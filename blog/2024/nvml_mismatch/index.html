<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>NVML: Driver/library Version Mismatch | Hung-Yueh Chiang</title> <meta name="author" content="Hung-Yueh Chiang"> <meta name="description" content="Solving NVML: Driver/library Version Mismatch"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/ut_shield.png"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="/blog/2024/nvml_mismatch/"> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Hung-Yueh </span>Chiang</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">NVML: Driver/library Version Mismatch</h1> <p class="post-meta">June 30, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/linux"> <i class="fas fa-hashtag fa-sm"></i> linux,</a>   <a href="/blog/tag/ubuntu"> <i class="fas fa-hashtag fa-sm"></i> ubuntu,</a>   <a href="/blog/tag/nvidia"> <i class="fas fa-hashtag fa-sm"></i> nvidia,</a>   <a href="/blog/tag/commands"> <i class="fas fa-hashtag fa-sm"></i> commands</a>   </p> </header> <article class="post-content"> <h1 id="introduction">Introduction</h1> <p>The Ubuntu kernel and Nvidia driver will be updated automatically and sometimes cause driver mismatch issues on the system. This document shows how to solve the Nvidia driver mismatch problem on a Ubuntu OS.</p> <blockquote> <p>[TL;DR]<br> The first thing you need to try is rebooting the machine!</p> </blockquote> <p>If rebooting does not work for your case, please try the following steps.</p> <h1 id="issue">Issue</h1> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nvidia-smi
Failed to initialize NVML: Driver/library version mismatch
NVML library version: 550.54
</code></pre></div></div> <p>Check kernel message</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>dmesg
...
<span class="o">[</span> 1865.855970] NVRM: API mismatch: the client has the version 550.54.14, but
               NVRM: this kernel module has the version 545.23.08.  Please
               NVRM: make sure that this kernel module and all NVIDIA driver
               NVRM: components have the same version.
...
</code></pre></div></div> <h1 id="solution">Solution</h1> <p><br></p> <h4 id="step-1-check-system-driver-and-process-driver">Step 1. Check system driver and process driver</h4> <ul> <li>The current running driver is <code class="language-plaintext highlighter-rouge">545.23.08</code> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /proc/driver/nvidia/version
NVRM version: NVIDIA UNIX x86_64 Kernel Module  545.23.08  Mon Nov  6 23:49:37 UTC 2023
GCC version:  gcc version 11.4.0 <span class="o">(</span>Ubuntu 11.4.0-1ubuntu1~22.04<span class="o">)</span> 
</code></pre></div> </div> </li> <li>The system driver in the Dynamic Kernel Module is <code class="language-plaintext highlighter-rouge">545.23.08</code> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dkms status
nvidia/545.23.08, 5.15.0-94-generic, x86_64: installed
nvidia/545.23.08, 5.15.0-97-generic, x86_64: installed
<span class="nv">$ </span>modinfo nvidia | <span class="nb">grep</span> ^version
version:        545.23.08
</code></pre></div> </div> </li> </ul> <p><br></p> <h4 id="step-2-check-available-drivers">Step 2. Check available drivers</h4> <p><code class="language-plaintext highlighter-rouge">nvidia-driver-550 - third-party non-free recommended</code> is the recommended driver.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>ubuntu-drivers devices
<span class="o">==</span> /sys/devices/pci0000:00/0000:00:01.1/0000:01:00.0 <span class="o">==</span>
modalias : pci:v000010DEd00002231sv000010DEsd0000147Ebc03sc00i00
vendor   : NVIDIA Corporation
model    : GA102GL <span class="o">[</span>RTX A5000]
manual_install: True
driver   : nvidia-driver-535-server-open - third-party non-free
driver   : nvidia-driver-525-server - third-party non-free
driver   : nvidia-driver-535-server - third-party non-free
driver   : nvidia-driver-545-open - third-party non-free
driver   : nvidia-driver-470-server - third-party non-free
driver   : nvidia-driver-535-open - third-party non-free
driver   : nvidia-driver-525-open - third-party non-free
driver   : nvidia-driver-550-open - third-party non-free
driver   : nvidia-driver-550 - third-party non-free recommended
driver   : xserver-xorg-video-nouveau - distro free <span class="nb">builtin</span>
</code></pre></div></div> <p><br></p> <h4 id="step-3-try-to-install-the-recommended-driver-first">Step 3. Try to install the recommended driver first</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>nvidia-driver-550 nvidia-dkms-550
</code></pre></div></div> <p><br></p> <h4 id="step-4-solving-the-error-trying-to-overwrite">Step 4. Solving the error: trying to overwrite</h4> <p>If you get this error</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unpacking libnvidia-gl-550:amd64 <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span> ...
dpkg: error processing archive /var/cache/apt/archives/libnvidia-gl-550_550.54.14-0ubuntu1_amd64.deb <span class="o">(</span><span class="nt">--unpack</span><span class="o">)</span>:
 trying to overwrite <span class="s1">'/usr/lib/x86_64-linux-gnu/libnvidia-api.so.1'</span>, which is also <span class="k">in </span>package libnvidia-extra-545:amd64 545.23.08-0ubuntu1
dpkg-deb: error: <span class="nb">paste </span>subprocess was killed by signal <span class="o">(</span>Broken pipe<span class="o">)</span>
Errors were encountered <span class="k">while </span>processing:
</code></pre></div></div> <p>Try to force install the driver. There will be an error at the end of the message, but this should be fine.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>dpkg <span class="nt">-i</span> <span class="nt">--force-overwrite</span> /var/cache/apt/archives/libnvidia-gl-550_550.54.14-0ubuntu1_amd64.deb 
<span class="o">(</span>Reading database ... 292518 files and directories currently installed.<span class="o">)</span>
Preparing to unpack .../libnvidia-gl-550_550.54.14-0ubuntu1_amd64.deb ...
dpkg-query: no packages found matching libnvidia-gl-535
Unpacking libnvidia-gl-550:amd64 <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span> ...
dpkg: warning: overriding problem because <span class="nt">--force</span> enabled:
dpkg: warning: trying to overwrite <span class="s1">'/usr/lib/x86_64-linux-gnu/libnvidia-api.so.1'</span>, which is also <span class="k">in </span>package libnvidia-extra-545:amd64 545.23.08-0ubuntu1
dpkg: dependency problems prevent configuration of libnvidia-gl-550:amd64:
 libnvidia-gl-550:amd64 depends on libnvidia-common-550<span class="p">;</span> however:
  Package libnvidia-common-550 is not configured yet.
 libnvidia-gl-550:amd64 depends on libnvidia-compute-550 <span class="o">(&gt;=</span> 550.54.14<span class="o">)</span><span class="p">;</span> however:
  Package libnvidia-compute-550:amd64 is not configured yet.

dpkg: error processing package libnvidia-gl-550:amd64 <span class="o">(</span><span class="nt">--install</span><span class="o">)</span>:
 dependency problems - leaving unconfigured
Processing triggers <span class="k">for </span>libc-bin <span class="o">(</span>2.35-0ubuntu3.6<span class="o">)</span> ...
Errors were encountered <span class="k">while </span>processing:
 libnvidia-gl-550:amd64
</code></pre></div></div> <p>Then, fix the broken dependency.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>base<span class="o">)</span> lab-admin@hopper:~<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nt">--fix-broken</span> <span class="nb">install</span>
....
depmod...
Setting up libnvidia-encode-550:amd64 <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span> ...
Setting up nvidia-driver-550 <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span> ...
Setting up cuda-drivers-550 <span class="o">(</span>550.54.14-1<span class="o">)</span> ...
Setting up cuda-drivers <span class="o">(</span>550.54.14-1<span class="o">)</span> ...
Processing triggers <span class="k">for </span>libc-bin <span class="o">(</span>2.35-0ubuntu3.6<span class="o">)</span> ...
Processing triggers <span class="k">for </span>man-db <span class="o">(</span>2.10.2-1<span class="o">)</span> ...
Processing triggers <span class="k">for </span>initramfs-tools <span class="o">(</span>0.140ubuntu13.4<span class="o">)</span> ...
update-initramfs: Generating /boot/initrd.img-5.15.0-97-generic
W: Possible missing firmware /lib/firmware/ast_dp501_fw.bin <span class="k">for </span>module ast
Package profile updates
        status: 1
        updates: <span class="o">[]</span>
        exceptions: 
        
needrestart is being skipped since dpkg has failed
</code></pre></div></div> <p>Check the recommended driver is fixed</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>base<span class="o">)</span> lab-admin@hopper:~<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nt">--fix-broken</span> <span class="nb">install </span>nvidia-driver-550 nvidia-dkms-550
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
nvidia-dkms-550 is already the newest version <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span><span class="nb">.</span>
nvidia-dkms-550 <span class="nb">set </span>to manually installed.
nvidia-driver-550 is already the newest version <span class="o">(</span>550.54.14-0ubuntu1<span class="o">)</span><span class="nb">.</span>
nvidia-driver-550 <span class="nb">set </span>to manually installed.
The following packages were automatically installed and are no longer required:
  libwmf0.2-7 nsight-compute-2023.3.0
Use <span class="s1">'sudo apt autoremove'</span> to remove them.
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
</code></pre></div></div> <p>But now if you try the driver, it will show the same error. (Not sure if we restart the machine now will fix it)</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nvidia-smi
Failed to initialize NVML: Driver/library version mismatch
NVML library version: 550.54
</code></pre></div></div> <p><br></p> <h4 id="step-5-purge-all-nvidia-drivers-and-re-install">Step 5. Purge all nvidia drivers and re-install</h4> <p>We will continue to purge all nvidia drivers first and re-install it again to keep our system environment simple. As you can see, there are lots of drivers in the system, for example nvidia-dkms-xxx</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dpkg <span class="nt">-l</span> | <span class="nb">grep </span>nvidia
ii  libnvidia-cfg1-550:amd64                          550.54.14-0ubuntu1                      amd64        NVIDIA binary OpenGL/GLX configuration library
ii  libnvidia-common-550                              550.54.14-0ubuntu1                      all          Shared files used by the NVIDIA libraries
rc  libnvidia-compute-515:amd64                       515.105.01-0ubuntu0.22.04.1             amd64        NVIDIA libcompute package
rc  libnvidia-compute-515-server:amd64                515.65.01-0ubuntu0.22.04.1              amd64        NVIDIA libcompute package
rc  libnvidia-compute-530:amd64                       530.30.02-0ubuntu1                      amd64        NVIDIA libcompute package
rc  libnvidia-compute-545:amd64                       545.23.08-0ubuntu1                      amd64        NVIDIA libcompute package
ii  libnvidia-compute-550:amd64                       550.54.14-0ubuntu1                      amd64        NVIDIA libcompute package
ii  libnvidia-container-tools                         1.14.5-1                                amd64        NVIDIA container runtime library <span class="o">(</span>command-line tools<span class="o">)</span>
ii  libnvidia-container1:amd64                        1.14.5-1                                amd64        NVIDIA container runtime library
ii  libnvidia-decode-550:amd64                        550.54.14-0ubuntu1                      amd64        NVIDIA Video Decoding runtime libraries
ii  libnvidia-encode-550:amd64                        550.54.14-0ubuntu1                      amd64        NVENC Video Encoding runtime library
ii  libnvidia-extra-550:amd64                         550.54.14-0ubuntu1                      amd64        Extra libraries <span class="k">for </span>the NVIDIA driver
ii  libnvidia-fbc1-550:amd64                          550.54.14-0ubuntu1                      amd64        NVIDIA OpenGL-based Framebuffer Capture runtime library
ii  libnvidia-gl-550:amd64                            550.54.14-0ubuntu1                      amd64        NVIDIA OpenGL/GLX/EGL/GLES GLVND libraries and Vulkan ICD
rc  linux-modules-nvidia-515-server-5.15.0-47-generic 5.15.0-47.51                            amd64        Linux kernel nvidia modules <span class="k">for </span>version 5.15.0-47
rc  linux-objects-nvidia-515-server-5.15.0-47-generic 5.15.0-47.51                            amd64        Linux kernel nvidia modules <span class="k">for </span>version 5.15.0-47 <span class="o">(</span>objects<span class="o">)</span>
rc  nvidia-compute-utils-515                          515.105.01-0ubuntu0.22.04.1             amd64        NVIDIA compute utilities
rc  nvidia-compute-utils-515-server                   515.65.01-0ubuntu0.22.04.1              amd64        NVIDIA compute utilities
rc  nvidia-compute-utils-530                          530.30.02-0ubuntu1                      amd64        NVIDIA compute utilities
rc  nvidia-compute-utils-545                          545.23.08-0ubuntu1                      amd64        NVIDIA compute utilities
ii  nvidia-compute-utils-550                          550.54.14-0ubuntu1                      amd64        NVIDIA compute utilities
ii  nvidia-container-toolkit                          1.14.5-1                                amd64        NVIDIA Container toolkit
ii  nvidia-container-toolkit-base                     1.14.5-1                                amd64        NVIDIA Container Toolkit Base
rc  nvidia-cuda-toolkit                               11.5.1-1ubuntu1                         amd64        NVIDIA CUDA development toolkit
rc  nvidia-dkms-515                                   515.105.01-0ubuntu0.22.04.1             amd64        NVIDIA DKMS package
rc  nvidia-dkms-530                                   530.30.02-0ubuntu1                      amd64        NVIDIA DKMS package
rc  nvidia-dkms-545                                   545.23.08-0ubuntu1                      amd64        NVIDIA DKMS package
ii  nvidia-dkms-550                                   550.54.14-0ubuntu1                      amd64        NVIDIA DKMS package
ii  nvidia-docker2                                    2.13.0-1                                all          nvidia-docker CLI wrapper
ii  nvidia-driver-550                                 550.54.14-0ubuntu1                      amd64        NVIDIA driver metapackage
ii  nvidia-firmware-550-550.54.14                     550.54.14-0ubuntu1                      amd64        Firmware files used by the kernel module
rc  nvidia-kernel-common-515                          515.105.01-0ubuntu0.22.04.1             amd64        Shared files used with the kernel module
rc  nvidia-kernel-common-515-server                   515.65.01-0ubuntu0.22.04.1              amd64        Shared files used with the kernel module
rc  nvidia-kernel-common-530                          530.30.02-0ubuntu1                      amd64        Shared files used with the kernel module
rc  nvidia-kernel-common-545                          545.23.08-0ubuntu1                      amd64        Shared files used with the kernel module
ii  nvidia-kernel-common-550                          550.54.14-0ubuntu1                      amd64        Shared files used with the kernel module
ii  nvidia-kernel-source-550                          550.54.14-0ubuntu1                      amd64        NVIDIA kernel <span class="nb">source </span>package
ii  nvidia-modprobe                                   545.23.08-0ubuntu1                      amd64        Load the NVIDIA kernel driver and create device files
ii  nvidia-prime                                      0.8.17.1                                all          Tools to <span class="nb">enable </span>NVIDIA<span class="s1">'s Prime
ii  nvidia-settings                                   545.23.08-0ubuntu1                      amd64        Tool for configuring the NVIDIA graphics driver
ii  nvidia-utils-550                                  550.54.14-0ubuntu1                      amd64        NVIDIA driver support binaries
ii  screen-resolution-extra                           0.18.2                                  all          Extension for the nvidia-settings control panel
ii  xserver-xorg-video-nvidia-550                     550.54.14-0ubuntu1                      amd64        NVIDIA binary Xorg driver
</span></code></pre></div></div> <p>Remove all nvidia related packages.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nt">--purge</span> remove <span class="k">*</span>nvidia<span class="k">*</span>

The following packages were automatically installed and are no longer required:
  dctrl-tools dkms libgdk-pixbuf-xlib-2.0-0 libgdk-pixbuf2.0-0 libwmf0.2-7 nsight-compute-2023.3.0 pkg-config screen-resolution-extra
Use <span class="s1">'sudo apt autoremove'</span> to remove them.
The following packages will be REMOVED:
  cuda<span class="k">*</span> cuda-12-3<span class="k">*</span> cuda-demo-suite-12-3<span class="k">*</span> cuda-drivers<span class="k">*</span> cuda-drivers-550<span class="k">*</span> cuda-runtime-12-3<span class="k">*</span> libnvidia-cfg1-550<span class="k">*</span> libnvidia-common-550<span class="k">*</span>
  libnvidia-compute-515<span class="k">*</span> libnvidia-compute-515-server<span class="k">*</span> libnvidia-compute-530<span class="k">*</span> libnvidia-compute-545<span class="k">*</span> libnvidia-compute-550<span class="k">*</span>
  libnvidia-container-tools<span class="k">*</span> libnvidia-container1<span class="k">*</span> libnvidia-decode-550<span class="k">*</span> libnvidia-encode-550<span class="k">*</span> libnvidia-extra-550<span class="k">*</span> libnvidia-fbc1-550<span class="k">*</span>
  libnvidia-gl-550<span class="k">*</span> linux-modules-nvidia-515-server-5.15.0-47-generic<span class="k">*</span> linux-objects-nvidia-515-server-5.15.0-47-generic<span class="k">*</span>
  nvidia-compute-utils-515<span class="k">*</span> nvidia-compute-utils-515-server<span class="k">*</span> nvidia-compute-utils-530<span class="k">*</span> nvidia-compute-utils-545<span class="k">*</span> nvidia-compute-utils-550<span class="k">*</span>
  nvidia-container-toolkit<span class="k">*</span> nvidia-container-toolkit-base<span class="k">*</span> nvidia-cuda-toolkit<span class="k">*</span> nvidia-dkms-515<span class="k">*</span> nvidia-dkms-530<span class="k">*</span> nvidia-dkms-545<span class="k">*</span>
  nvidia-dkms-550<span class="k">*</span> nvidia-docker2<span class="k">*</span> nvidia-driver-550<span class="k">*</span> nvidia-firmware-550-550.54.14<span class="k">*</span> nvidia-kernel-common-515<span class="k">*</span> nvidia-kernel-common-515-server<span class="k">*</span>
  nvidia-kernel-common-530<span class="k">*</span> nvidia-kernel-common-545<span class="k">*</span> nvidia-kernel-common-550<span class="k">*</span> nvidia-kernel-source-550<span class="k">*</span> nvidia-modprobe<span class="k">*</span> nvidia-prime<span class="k">*</span>
  nvidia-settings<span class="k">*</span> nvidia-utils-550<span class="k">*</span> xserver-xorg-video-nvidia-550<span class="k">*</span>
0 upgraded, 0 newly installed, 48 to remove and 2 not upgraded.
After this operation, 751 MB disk space will be freed.
Do you want to <span class="k">continue</span>? <span class="o">[</span>Y/n]  Y
</code></pre></div></div> <p>Check the environment again to make sure there is no NVIDIA related packages</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dpkg <span class="nt">-l</span> | <span class="nb">grep </span>nvidia
ii  screen-resolution-extra                    0.18.2                                  all          Extension <span class="k">for </span>the nvidia-settings control panel
</code></pre></div></div> <p><br></p> <h4 id="step-6-re-install-the-recommended-driver">Step 6. Re-install the recommended driver</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>nvidia-driver-550 nvidia-dkms-550
</code></pre></div></div> <p>Check the environment again after the recommended driver is installed.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dpkg <span class="nt">-l</span> | <span class="nb">grep </span>nvidia
ii  libnvidia-cfg1-550:amd64                   550.54.14-0ubuntu1                      amd64        NVIDIA binary OpenGL/GLX configuration library
ii  libnvidia-common-550                       550.54.14-0ubuntu1                      all          Shared files used by the NVIDIA libraries
ii  libnvidia-compute-550:amd64                550.54.14-0ubuntu1                      amd64        NVIDIA libcompute package
ii  libnvidia-decode-550:amd64                 550.54.14-0ubuntu1                      amd64        NVIDIA Video Decoding runtime libraries
ii  libnvidia-encode-550:amd64                 550.54.14-0ubuntu1                      amd64        NVENC Video Encoding runtime library
ii  libnvidia-extra-550:amd64                  550.54.14-0ubuntu1                      amd64        Extra libraries <span class="k">for </span>the NVIDIA driver
ii  libnvidia-fbc1-550:amd64                   550.54.14-0ubuntu1                      amd64        NVIDIA OpenGL-based Framebuffer Capture runtime library
ii  libnvidia-gl-550:amd64                     550.54.14-0ubuntu1                      amd64        NVIDIA OpenGL/GLX/EGL/GLES GLVND libraries and Vulkan ICD
ii  nvidia-compute-utils-550                   550.54.14-0ubuntu1                      amd64        NVIDIA compute utilities
ii  nvidia-dkms-550                            550.54.14-0ubuntu1                      amd64        NVIDIA DKMS package
ii  nvidia-driver-550                          550.54.14-0ubuntu1                      amd64        NVIDIA driver metapackage
ii  nvidia-firmware-550-550.54.14              550.54.14-0ubuntu1                      amd64        Firmware files used by the kernel module
ii  nvidia-kernel-common-550                   550.54.14-0ubuntu1                      amd64        Shared files used with the kernel module
ii  nvidia-kernel-source-550                   550.54.14-0ubuntu1                      amd64        NVIDIA kernel <span class="nb">source </span>package
ii  nvidia-prime                               0.8.17.1                                all          Tools to <span class="nb">enable </span>NVIDIA<span class="s1">'s Prime
ii  nvidia-settings                            550.54.14-0ubuntu1                      amd64        Tool for configuring the NVIDIA graphics driver
ii  nvidia-utils-550                           550.54.14-0ubuntu1                      amd64        NVIDIA driver support binaries
ii  screen-resolution-extra                    0.18.2                                  all          Extension for the nvidia-settings control panel
ii  xserver-xorg-video-nvidia-550              550.54.14-0ubuntu1                      amd64        NVIDIA binary Xorg driver
</span></code></pre></div></div> <p>But now if you try the driver, it will show the same error. We need to reboot the machine first to reload the driver.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nvidia-smi
Failed to initialize NVML: Driver/library version mismatch
NVML library version: 550.54
</code></pre></div></div> <p>Reboot</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>reboot
</code></pre></div></div> <p><br></p> <h4 id="step-7-optional-keep-the-kernel-version">Step 7 (Optional) Keep the kernel version</h4> <blockquote> <p>[Warning]<br> This will prevent the machine from some important updates</p> </blockquote> <p>If we want to keep the version and prevent this happening again, we could use</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sb">`</span>apt-mark hold<span class="sb">`</span> 
<span class="nv">$ </span><span class="nb">sudo </span>apt-mark hold nvidia-dkms-550: 
nvidia-dkms-550 <span class="nb">set </span>on hold.
<span class="nv">$ </span><span class="nb">sudo </span>apt-mark hold nvidia-driver-550
nvidia-driver-550 <span class="nb">set </span>on hold.
<span class="nv">$ </span><span class="nb">sudo </span>apt-mark hold nvidia-utils-550
nvidia-utils-550 <span class="nb">set </span>on hold.
<span class="nv">$ </span><span class="nb">uname</span> <span class="nt">-r</span>
5.15.0-97-generic
<span class="nv">$ </span><span class="nb">sudo </span>apt-mark hold 5.15.0-97-generic <span class="c"># hold the kernel</span>
</code></pre></div></div> <h1 id="reference">Reference:</h1> <ul> <li><a href="https://stackoverflow.com/questions/74151409/nvidia-nvml-driver-library-version-mismatch-dkms-modules-drivers-and-modinfo" rel="external nofollow noopener" target="_blank">https://stackoverflow.com/questions/74151409/nvidia-nvml-driver-library-version-mismatch-dkms-modules-drivers-and-modinfo</a></li> <li><a href="https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch/67105064#67105064" rel="external nofollow noopener" target="_blank">https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch/67105064#67105064</a></li> <li><a href="https://forums.developer.nvidia.com/t/problem-with-apt-and-nvidia-440-on-ubuntu-20-04/115281/2" rel="external nofollow noopener" target="_blank">https://forums.developer.nvidia.com/t/problem-with-apt-and-nvidia-440-on-ubuntu-20-04/115281/2</a></li> <li><a href="https://askubuntu.com/questions/1436506/how-to-resolve-unmet-dependencies-error-when-upgrading-depends-nvidia-kernel-c" rel="external nofollow noopener" target="_blank">https://askubuntu.com/questions/1436506/how-to-resolve-unmet-dependencies-error-when-upgrading-depends-nvidia-kernel-c</a></li> <li><a href="https://askubuntu.com/questions/938494/how-to-i-prevent-ubuntu-from-kernel-version-upgrade-and-notification" rel="external nofollow noopener" target="_blank">https://askubuntu.com/questions/938494/how-to-i-prevent-ubuntu-from-kernel-version-upgrade-and-notification</a></li> </ul> </article><div id="disqus_thread" style="max-width: 1000px; margin: 0 auto"></div> <script type="text/javascript">var disqus_shortname="https-hychiang-info",disqus_identifier="/blog/2024/nvml_mismatch",disqus_title="NVML: Driver/library Version Mismatch";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by Disqus.</a> </noscript> </div> </div> <footer class="sticky-bottom mt-5"> <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?cl=ffffff&amp;w=190&amp;t=tt&amp;d=63L-AOUUXV7dNP9sE0J35-A9m9tVx4XT7qV2CT9AAC8&amp;co=2d78ad&amp;cmo=3acc3a&amp;cmn=ff5353&amp;ct=ffffff"></script> <div class="container"> © Copyright 2024 Hung-Yueh Chiang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: June 30, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>